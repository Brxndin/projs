<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Cripta</title>
        <style>

            body{

              background-color: #520a06;

            }

            #p{

                background-color: #368203;

            }

            .i{

                background-color: red;

            }

            .o{

                background-color: brown;

            }
            
            .ar{
              
              background-color: gray;
              border: 1px solid black;
              
            }

            .po{

              background-color: #b0279b;

            }
            
            .it{
              
              border: 1px solid black;
              background-color: yellow;
              
            }

            #mapa{

                background-color: #e8b07b;

            }

            .menu{

              display: none;
              z-index: 99;
              background-color: #520a06;
              color: white;
              position: absolute;
              width: 500px;
              height: 500px;
              border: 2px solid white;
              left: 650px;
              top: 300px;
              padding: 20px;
              /*
              overflow-y: scroll;
              */

            }
            
            .botao{
              
              width: 150px;
              height: 50px;
              border: 1px solid white;
              color: white;
              background-color: #520a06;
              
            }
            
            .titulo{
              
              color: white;
              
            }

        </style>
    </head>
    <body>
        <div id="inicial" style="text-align: center;">
          <h1 class="titulo">Cripta</h1>
          <button class="botao" id="novo">Novo Jogo</button>
        </div>
        <div id="div_inv" class="menu">
          <h1>Inventário</h1>
          <div id="div_inv_content">
            
          </div>
        </div>
        <div id="div_equip" class="menu">
          <h1>Status</h1>
          <div id="status">

          </div>
          <h1>Equipamento</h1>
          <div id="div_equip_content">
            
          </div>
        </div>
        <div id="canvas">

        </div>

        <script>
            
            // gera um numero inteiro pseudoaleatorio
            function randint(min, max){

                min = Math.ceil(min);
                max = Math.floor(max + 1);

                return Math.floor(Math.random() * (max - min)) + min;

            }

            //retorna true ou false de acordo com a chance em porcentagem informada
            //exemplo: perc(50) tem 50% de chance de retornar true
            function perc(n){

              if(randint(1, 100) <= n){

                return true;

              }else{

                return false;

              }

            }

            c = document.getElementById('canvas');

            function criar_tag(obj){

              var tag = document.createElement(obj.tp);
              tag.style.position = 'absolute';

              for(const i in obj){

                if(i == 'style'){

                  for(const j in obj[i]){

                    tag.style[j] = obj[i][j];

                  }

                }else if(i == 'att'){

                  for(const j in obj[i]){

                    tag.setAttribute(j, obj[i][j]);

                  }

                }else if(i != 'tp'){

                  tag[i] = obj[i];

                }

              }

              return tag;

            }

            var lista_mapas = {

              '0': {

                'x': Math.round(screen.width/4),
                'y': Math.round(screen.height/7),
                'alt': Math.round(screen.height * (55.5/100)),
                'larg': Math.round(screen.width * (50/100)),
                'func': function(){

                  if(perc(33)){

                    criar_obstaculo(Math.round(this.x + this.larg/2 - 40), Math.round(this.y + this.alt/2 - 40), 80, 80);

                  }else if(perc(33)){

                    criar_obstaculo(this.x, 550, 500, 50);
                    criar_obstaculo(this.x + this.larg - 500, 300, 500, 50);

                  }

                }

              },
              '1': {

                'x': Math.round((screen.width/2) - ((screen.width * (20/100))/2)),
                'y': Math.round(screen.height/7),
                'alt': Math.round(screen.height * (55.5/100)),
                'larg': Math.round(screen.width * (20/100)),
                'func': function(){

                  if(perc(50)){

                    criar_obstaculo(Math.round(this.x + this.larg/2 - 40), Math.round(this.y + this.alt/2 - 40), 80, 80);

                  }

                }

              }

            }

            var lista_portais = {

                //esquerda
                '1': {

                  'id': 'po1',
                  'larg': 30,
                  'alt': 90,
                  'func': () => {
                      
                    criar_obstaculo(mapa.x, mapa.y + Math.floor((mapa.alt/2)) - 45 - 30, 40, 30);
                    criar_obstaculo(mapa.x, mapa.y + Math.floor((mapa.alt/2)) - 45 + 90, 40, 30);
                    
                  }

                },
                //direita
                '2': {

                  'id': 'po2',
                  'larg': 30,
                  'alt': 90,
                  'func': () => {
                      
                    criar_obstaculo(mapa.x + mapa.larg - 40, mapa.y + Math.floor((mapa.alt/2)) - 45 - 30, 40, 30);
                    criar_obstaculo(mapa.x + mapa.larg - 40, mapa.y + Math.floor((mapa.alt/2)) - 45 + 90, 40, 30);
                    
                  }

                },
                //cima
                '3': {

                  'id': 'po3',
                  'larg': 90,
                  'alt': 30,
                  'func': () => {
                      
                    criar_obstaculo(mapa.x + Math.floor((mapa.larg/2)) - 45 - 30, mapa.y, 30, 40);
                    criar_obstaculo(mapa.x + Math.floor((mapa.larg/2)) - 45 + 90, mapa.y, 30, 40);
                    
                  }

                },
                //baixo
                '4': {
                    
                  'id': 'po4',
                  'larg': 90,
                  'alt': 30,
                  'func': () => {

                    criar_obstaculo(mapa.x + Math.floor((mapa.larg/2)) - 45 - 30, mapa.y + mapa.alt - 40, 30, 40);
                    criar_obstaculo(mapa.x + Math.floor((mapa.larg/2)) - 45 + 90, mapa.y + mapa.alt - 40, 30, 40);

                  }

                }

              }

            var mapa = {};

            var portais = {};

            function criar_portais(n){

              lista_portais['1'].x = mapa.x;
              lista_portais['1'].y = mapa.y + Math.floor((mapa.alt/2)) - 45;

              lista_portais['2'].x = mapa.x + mapa.larg - 30;
              lista_portais['2'].y = mapa.y + Math.floor((mapa.alt/2)) - 45;
              
              lista_portais['3'].x = mapa.x + Math.floor((mapa.larg/2)) - 45;
              lista_portais['3'].y = mapa.y;

              lista_portais['4'].x = mapa.x + Math.floor((mapa.larg/2)) - 45;
              lista_portais['4'].y = mapa.y + mapa.alt - 30;

              portais[n] = lista_portais[n];

              c.appendChild(criar_tag({
                  
                'tp': 'div',
                'att': {

                  'id': portais[n].id,
                  'class': 'po'

                },
                'style': {

                  'width': portais[n].larg + 'px',
                  'height': portais[n].alt + 'px',
                  'left': portais[n].x + 'px',
                  'top': portais[n].y + 'px'

                }

              }));

              portais[n].func();

            }

            function criar_mapa(){

              mapa = lista_mapas[randint(0, 1)];

              mapa.id = 'mapa';

              c.appendChild(criar_tag({
                
                'tp': 'div',
                'att': {

                  'id': mapa.id

                },
                'style': {

                  'width': mapa.larg + 'px',
                  'height': mapa.alt + 'px',
                  'left': mapa.x + 'px',
                  'top': mapa.y + 'px'

                }

              }));

              mapa.func();

            }
            
            var lista_itens = {
              
              'vazio': {
                
                'nome': 'vazio',
                'texto': 'Vazio',
                'poder': 0
                
              },
              0: {
                
                'nome': 'espada_ferro',
                'texto': 'Espada de Ferro',
                'poder': 40,
                'tipo': 'arma',
                'tipo_atq': 'c'
                
              },
              1: {
                
                'nome': 'armadura_ferro',
                'texto': 'Armadura de Ferro',
                'poder': 40,
                'tipo': 'armadura'
                
              },
              2: {
                
                'nome': 'espada_ouro',
                'texto': 'Espada Dourada',
                'poder': 70,
                'tipo': 'arma',
                'tipo_atq': 'c'
                
              },
              3: {
                
                'nome': 'armadura_trevas',
                'texto': 'Armadura das Trevas',
                'poder': 60,
                'tipo': 'armadura'
                
              },
              4: {

                'nome': 'pocao_hp',
                'texto': 'Poção de HP',
                'poder': 25,
                'tipo': 'cura'

              },
              5: {

                'nome': 'pocao_grande_hp',
                'texto': 'Poção Grande de HP',
                'poder': 50,
                'tipo': 'cura'

              },
              6: {
                
                'nome': 'arco_madeira',
                'texto': 'Arco de Madeira',
                'poder': 30,
                'tipo': 'arma',
                'tipo_atq': 'd'
                
              }
              
            }

            var inimigos = {

            }

            var obstaculos = {

            }
            
            var itens = {
              
            }

            var armas = {

            }
            
            // faz um objeto mudar de posição
            function andar(obj, d){

                if(d == 'direita'){

                    if((obj.x + obj.larg) < (mapa.x + mapa.larg)){

                        obj.x++;
                        document.getElementById(obj.id).style.left = obj.x + 'px';

                    }

                }else if(d == 'esquerda'){

                    if(obj.x > mapa.x){

                        obj.x--;
                        document.getElementById(obj.id).style.left = obj.x + 'px';

                    }

                }else if(d == 'cima'){

                    if(obj.y > mapa.y){

                        obj.y--;
                        document.getElementById(obj.id).style.top = obj.y + 'px';

                    }

                }else if(d == 'baixo'){

                    if((obj.y + obj.alt) < (mapa.y + mapa.alt)){
                        
                        obj.y++;
                        document.getElementById(obj.id).style.top = obj.y + 'px';

                    }

                }

            }

            function pontos(obj){

              return {

                'a': {

                  'x': obj.x,
                  'y': obj.y

                },
                'b': {

                  'x': obj.x,
                  'y': obj.y + obj.alt

                },
                'c': {

                  'x': obj.x + obj.larg,
                  'y': obj.y

                },
                'd': {

                  'x': obj.x + obj.larg,
                  'y': obj.y + obj.alt

                }

              }

            }
            
            // valida o movimento de um objeto baseado na direção e colisão com outro objeto
            function movimento(obj1, obj2, d){
              
                obj1.face = d;

                var pt1 = pontos(obj1);
                var pt2 = pontos(obj2);

                if(d == 'direita'){

                    if(pt1.c.x + 1 == pt2.b.x){

                        if(pt1.c.y >= pt2.a.y && pt1.c.y <= pt2.b.y){

                            return false;

                        }else if(pt1.d.y >= pt2.a.y && pt1.d.y <= pt2.b.y){

                            return false;

                        }else if(pt1.c.y <= pt2.a.y && pt1.d.y >= pt2.b.y){

                            return false;

                        }else{

                            return true;

                        }

                    }else{

                        return true;

                    }

                }else if(d == 'esquerda'){

                    if(pt1.b.x - 1 == pt2.c.x){

                        if(pt1.b.y >= pt2.c.y && pt1.b.y <= pt2.d.y){

                            return false;

                        }else if(pt1.a.y >= pt2.c.y && pt1.a.y <= pt2.d.y){

                            return false;

                        }else if(pt1.a.y <= pt2.c.y && pt1.b.y >= pt2.d.y){

                            return false;

                        }else{

                            return true;

                        }

                    }else{

                        return true;

                    }

                }else if(d == 'cima'){

                    if(pt1.a.y - 1 == pt2.b.y){

                        if(pt1.c.x >= pt2.b.x && pt1.c.x <= pt2.d.x){

                            return false;

                        }else if(pt1.a.x >= pt2.b.x && pt1.a.x <= pt2.d.x){

                            return false;

                        }else if(pt1.a.x <= pt2.b.x && pt1.c.x >= pt2.d.x){

                            return false;

                        }else{

                            return true;

                        }

                    }else{

                        return true;

                    }

                }else if(d == 'baixo'){

                    if(pt1.b.y + 1 == pt2.a.y){

                        if(pt1.b.x >= pt2.a.x && pt1.b.x <= pt2.c.x){

                            return false;

                        }else if(pt1.d.x >= pt2.a.x && pt1.d.x <= pt2.c.x){

                            return false;

                        }else if(pt1.b.x <= pt2.a.x && pt1.d.x >= pt2.c.x){

                            return false;

                        }else{

                            return true;

                        }

                    }else{

                        return true;

                    }

                }else{

                    return false;

                }

            }
            
            // verifica a interação de movimento e colisão entre todos os objetos (jogador, inimigos e obstáculos)
            function mov_geral(obj, d){
          
              var e = true;
                  
              for(const i in inimigos){
                
                if(obj.id != inimigos[i].id){
                    
                  if(!movimento(obj, inimigos[i], d)){
                        
                    e = false;
                        
                  }
                
                }
                    
              }
              
              for(const i in obstaculos){
                
                if(obj.id != obstaculos[i].id){
                    
                  if(!movimento(obj, obstaculos[i], d)){
                        
                    e = false;
                        
                  }
                
                }
                    
              }
              
              if(e){
                
                andar(obj, d);
                
              }
              
            }
            
            // verifica se houve colisao entre dois objetos ou se ocupam o mesmo lugar (é mais usado no ataque)
            function colisao(obj1, obj2){
          
              var pt1 = pontos(obj1);
              var pt2 = pontos(obj2);
              
              var r;
              
              if(pt1.c.x + 1 >= pt2.b.x && pt1.b.x - 1 <= pt2.c.x && pt1.a.y - 1 <= pt2.b.y && pt1.b.y + 1 >= pt2.a.y){
    
                r = true;
                
              }else{
                
                r = false;
                
              }
              
              return r;
              
            }
            
            function criar_item(n, x_i, y_i){
              
              var w = Object.keys(itens).length + 1;
              
              obj = {
                
                'id': 'it' + w,
                'x': x_i,
                'y': y_i,
                'alt': 30,
                'larg': 30,
                'obj': lista_itens[n]
                
              }
              
              itens['item' + w] = obj;
              
              c.appendChild(criar_tag({
                
                'tp': 'div',
                'att': {

                  'id': obj.id,
                  'class': 'it'

                },
                'style': {
                  
                  'width': obj.larg + 'px',
                  'height': obj.alt + 'px',
                  'left': obj.x + 'px',
                  'top': obj.y + 'px'
                  
                }
                
              }));
              
            }

            function carregar_equip(){

              document.getElementById('status').innerHTML = '';

              document.getElementById('status').appendChild(criar_tag({

                'tp': 'p',
                'innerHTML': 'Vida: ' + jogador.hp + '/' + jogador.hp_max,
                'style': {

                  'fontSize': '20px',
                  'color': 'white',
                  'position': 'static'

                }

              }));

              document.getElementById('status').appendChild(criar_tag({

                'tp': 'p',
                'innerHTML': 'Força: ' + jogador.atq + ' +' + jogador.equipamento.arma.poder,
                'style': {

                  'fontSize': '20px',
                  'color': 'white',
                  'position': 'static'

                }

              }));

              var d = document.getElementById('div_equip_content');
              d.innerHTML = '';

              for(const i in jogador.equipamento){

                if(jogador.equipamento[i].nome != 'vazio'){

                  var string = criar_tag({

                    'tp': 'p',
                    'innerHTML': jogador.equipamento[i].texto,
                    'style': {

                      'fontSize': '20px',
                      'color': 'white',
                      'position': 'static'

                    }

                  });

                  var b = criar_tag({

                    'tp': 'button',
                    'innerHTML': 'Remover',
                    'style': {

                      'backgroundColor': '#520a06',
                      'border': '1px solid white',
                      'width': '80px',
                      'color': 'white',
                      'height': '30px'

                    },
                    'onclick': () => {
                        
                      rmv_equip(i);
                      carregar_equip();

                    }

                  });

                  string.appendChild(b);

                  d.appendChild(string);

                }

              }

            }

            function carregar_inv(){

              var d = document.getElementById('div_inv_content');
              d.innerHTML = '';

              for(const i in jogador.inventario){

                var string = criar_tag({

                  'tp': 'p',
                  'innerHTML': jogador.inventario[i].texto + ' (' + jogador.inventario[i].quantidade + 'x)',
                  'style': {

                    'fontSize': '20px',
                    'color': 'white',
                    'position': 'static'

                  }

                });

                if(jogador.inventario[i].tipo == 'cura'){
                  
                  var b = criar_tag({

                    'tp': 'button',
                    'innerHTML': 'Usar',
                    'style': {

                      'backgroundColor': '#520a06',
                      'border': '1px solid white',
                      'width': '80px',
                      'color': 'white',
                      'height': '30px'

                    },
                    'onclick': () => {
                      
                      curar(jogador.inventario[i].nome);
                      carregar_inv();

                    }

                  });

                  string.appendChild(b);

                }else{

                  var b = criar_tag({

                    'tp': 'button',
                    'innerHTML': 'Ad Equip',
                    'style': {

                      'backgroundColor': '#520a06',
                      'border': '1px solid white',
                      'width': '80px',
                      'color': 'white',
                      'height': '30px'

                    },
                    'onclick': () => {
                      
                      ad_equip(jogador.inventario[i]);
                      carregar_inv();

                    }

                  });

                  string.appendChild(b);

                }

                d.appendChild(string);

              }

            }
            
            function ad_inv(obj, p = undefined){
              
              var item = {
                
                'nome': obj.nome,
                'texto': obj.texto,
                'poder': obj.poder,
                'tipo': obj.tipo,
                'quantidade': 1
                
              }

              if(typeof obj.tipo_atq != 'undefined'){
                
                item.tipo_atq = obj.tipo_atq;
                
              }
              
              if(typeof jogador.inventario[item.nome] != 'undefined'){
                
                jogador.inventario[item.nome].quantidade += item.quantidade;
                
              }else{
                
                jogador.inventario[item.nome] = item;
                
              }
              
              if(typeof p != 'undefined'){
                
                document.getElementById(itens[p].id).remove();
                
                delete itens[p];
                
              }
              
            }
            
            function rmv_equip(t){
              
              if(typeof jogador.equipamento[t] != 'undefined'){
                
                if(jogador.equipamento[t].nome != 'vazio'){
                  
                  jogador.equipamento[t].tipo = t;
                  
                  ad_inv(jogador.equipamento[t]);
                  
                }
                
                jogador.equipamento[t] = lista_itens['vazio'];
                
              }
              
            }
            
            function ad_equip(obj){
              
              var item = {
                
                'nome': obj.nome,
                'texto': obj.texto,
                'poder': obj.poder
                
              }

              if(typeof obj.tipo_atq != 'undefined'){
                
                item.tipo_atq = obj.tipo_atq;
                
              }
              
              rmv_equip(obj.tipo);
              
              jogador.equipamento[obj.tipo] = item;
              
              if(obj.quantidade > 1){
                
                jogador.inventario[obj.nome].quantidade--;
                
              }else{
                
                delete jogador.inventario[obj.nome];
                
              }
              
            }

            var contador_arma = 0;

            function criar_arma(atacante, o_larg, o_alt){

              var w = contador_arma + 1;
              contador_arma++;

              var obj = {
                'id': 'ar' + w
              }

              if(atacante.face == 'esquerda'){
                
                obj.larg = o_larg;
                obj.alt = o_alt;
                obj.x = atacante.x - obj.larg;
                obj.y = Math.round(atacante.y + (atacante.alt/2) - (obj.alt/2));
                
              }else if(atacante.face == 'direita'){
                
                obj.larg = o_larg;
                obj.alt = o_alt;
                obj.x = atacante.x + atacante.larg;
                obj.y = Math.round(atacante.y + (atacante.alt/2) - (obj.alt/2));
                
              }else if(atacante.face == 'cima'){
                
                obj.larg = o_alt;
                obj.alt = o_larg;
                obj.x = Math.round(atacante.x + (atacante.larg/2) - (obj.larg/2));
                obj.y = atacante.y - obj.alt;
                
              }else if(atacante.face == 'baixo'){
                
                obj.larg = o_alt;
                obj.alt = o_larg;
                obj.x = Math.round(atacante.x + (atacante.larg/2) - (obj.larg/2));
                obj.y = atacante.y + atacante.alt;
                
              }

              armas['arma' + w] = obj;
                
              c.appendChild(criar_tag({
                
                'tp': 'div',
                'att': {

                  'id': obj.id,
                  'class': 'ar'

                },
                'style': {
                  
                  'width': obj.larg + 'px',
                  'height': obj.alt + 'px',
                  'left': obj.x + 'px',
                  'top': obj.y + 'px'
                  
                }
                
              }));

              return 'arma' + w;

            }
            
            function atacar(obj){
              
              var arma_id = criar_arma(obj, 25, 6);
              var ar = document.getElementById(armas[arma_id].id);

              //
              
              

               if(obj.equipamento.arma.tipo_atq == 'd'){

                 var projetil_id = criar_arma(obj, 25, 6);
                 var pr = document.getElementById(armas[projetil_id].id);
                 var face = obj.face;
                 var pos = {
                     'x': armas[projetil_id].x,
                     'y': armas[projetil_id].y
                 }

                 armas[projetil_id].mov = setInterval(() => {

                   andar(armas[projetil_id], face);

                   for(const i in inimigos){
                  
                     if(colisao(armas[projetil_id], inimigos[i])){
                      
                       inimigos[i].hp = Math.round(inimigos[i].hp - ((jogador.atq + jogador.equipamento.arma.poder) - ((inimigos[i].equipamento.armadura.poder/100) * (jogador.atq + jogador.equipamento.arma.poder))));
                      
                       if(inimigos[i].hp <= 0){

                         criar_item(randint(0, 6), inimigos[i].x, inimigos[i].y);
                         //criar_item(3);
                      
                         clearInterval(inimigos[i].mov);
                      
                         document.getElementById(inimigos[i].id).remove();
                      
                         delete inimigos[i];
                      
                       }

                       clearInterval(armas[projetil_id].mov);
                       pr.remove();
                       delete armas[projetil_id];
                      
                     }
                    
                   }

                 }, 0.5);
                 
                 setTimeout(() => {
                   
                   if(armas[projetil_id]){
                     
                     clearInterval(armas[projetil_id].mov);
                       pr.remove();
                       delete armas[projetil_id];
                     
                   }
                   
                 }, 1500);

               }
               
               

              //
              
              if(obj.id != jogador.id){
                
                if(colisao(armas[arma_id], obj)){
                    
                  jogador.hp = Math.round(jogador.hp - ((obj.atq + obj.equipamento.arma.poder) - ((jogador.equipamento.armadura.poder/100) * (obj.atq + obj.equipamento.arma.poder))));

                  if(jogador.hp <= 0){

                    delete armas[arma_id];
                    ar.remove();
                    reset();

                    jogador = {};

                    alert('Você morreu.');

                    document.getElementById('inicial').style.display = 'block';

                  }else{

                    document.getElementById('p_hp').setAttribute('value', jogador.hp);

                  }
                    
                }
                
                obj.pa = false;
              
                setTimeout(() => {
                  
                  delete armas[arma_id];
                  ar.remove();
                  
                  setTimeout(() => {
                    
                    obj.pa = true;
                    
                  }, 300);
                  
                }, 40);
              
              }else{
                
                setTimeout(() => {
                  
                  delete armas[arma_id];
                  ar.remove();
                  
                }, 40);
              
                for(const i in inimigos){
                  
                  if(colisao(armas[arma_id], inimigos[i])){
                    
                    inimigos[i].hp = Math.round(inimigos[i].hp - ((jogador.atq + jogador.equipamento.arma.poder) - ((inimigos[i].equipamento.armadura.poder/100) * (jogador.atq + jogador.equipamento.arma.poder))));
                    
                    if(inimigos[i].hp <= 0){

                      criar_item(randint(0, 6), inimigos[i].x, inimigos[i].y);
                      //criar_item(3);
                    
                      clearInterval(inimigos[i].mov);
                    
                      document.getElementById(inimigos[i].id).remove();
                    
                      delete inimigos[i];
                    
                    }
                    
                  }
                  
                }
              
              }
              
            }
            
            // inteligência artificial básica para os inimigos
            function ia(obj){

                if((jogador.x + jogador.larg) < (obj.x - 100) || jogador.x > (obj.x + obj.larg + 100) || (jogador.y + jogador.alt) < (obj.y - 100) || jogador.y > (obj.y + obj.alt + 100)){

                    if(obj.x < (obj.inix + 20) && obj.bool == true){

                        obj.bool = true;

                        mov_geral(obj, 'direita');

                    }else{

                        obj.bool = false;

                    }

                    if(obj.x > (obj.inix - 20) && obj.bool == false){

                        obj.bool = false;

                        mov_geral(obj, 'esquerda');

                    }else{

                        obj.bool = true;

                    }

                }else{

                    if(jogador.x < obj.x){

                      if(movimento(obj, jogador, 'esquerda')){
                
                        mov_geral(obj, 'esquerda');
                      
                      }else{
                        
                        if(obj.pa){
                          
                          atacar(obj);
                          
                        }
                        
                      }

                    }else if(jogador.x == obj.x){

                    }else{

                      if(movimento(obj, jogador, 'direita')){
                
                        mov_geral(obj, 'direita');
                      
                      }else{
                        
                        if(obj.pa){
                          
                          atacar(obj);
                          
                        }
                        
                      }

                    }

                    if(jogador.y < obj.y){

                      if(movimento(obj, jogador, 'cima')){
                
                        mov_geral(obj, 'cima');
                        
                      }else{
                        
                        if(obj.pa){
                          
                          atacar(obj);
                          
                        }
                        
                      }

                    }else if(jogador.y == obj.y){

                    }else{

                      if(movimento(obj, jogador, 'baixo')){
                
                        mov_geral(obj, 'baixo');
                        
                      }else{
                        
                        if(obj.pa){
                          
                          atacar(obj);
                          
                        }
                        
                      }

                    }

                }

            }
            
            // cria os inimigos e coloca no mapa
            function criar_inimigo(){

                var w = Object.keys(inimigos).length + 1;

                var obj = {

                  'id': 'i' + w,
                  'bool': true,
                  'pa': true,
                  'alt': 40,
                  'larg': 40,
                  'face': 'direita',
                  'hp': 200,
                  'atq': 10,
                  'equipamento': {
                      
                    'arma': {
                        
                      'nome': 'espada_simples',
                      'texto': 'Espada Simples',
                      'poder': 10
                      
                    },
                    'armadura': {
                        
                      'nome': 'armadura_simples',
                      'texto': 'Armadura Simples',
                      'poder': 10,
                      'tipo_atq': 'c'
                        
                    }
                      
                  }

                }

                let bool = {

                  'o': true,
                  'i': true

                };

                do{

                  bool.o = true;
                  bool.i = true;

                  obj.x = obj.inix = randint(mapa.x + 130, mapa.x + mapa.larg - 230);
                  obj.y = obj.iniy = randint(mapa.y + 130, mapa.y + mapa.alt - 230);

                  for(const i in inimigos){

                    if(colisao(inimigos[i], obj)){

                      bool.i = false;
                      break;

                    }

                  }

                  for(const i in obstaculos){

                    if(colisao(obstaculos[i], obj)){

                      bool.o = false;
                      break;

                    }

                  }

                }while(bool.i == false || bool.o == false);

                inimigos['inimigo' + w] = obj;

                c.appendChild(criar_tag({
                  
                  'tp': 'div',
                  'att': {

                    'id': obj.id,
                    'class': 'i'

                  },
                  'style': {

                    'width': obj.larg + 'px',
                    'height': obj.alt + 'px',
                    'left': obj.x + 'px',
                    'top': obj.y + 'px'

                  }

                }));

                inimigos['inimigo' + w].mov = setInterval(() => {

                    ia(inimigos['inimigo' + w]);

                }, 25);

            }

            // cria obstaculos e coloca no mapa
            function criar_obstaculo(x, y, larg, alt){

                var w = Object.keys(obstaculos).length + 1;

                var obj = {

                    'id': 'o' + w,
                    'x': x,
                    'y': y,
                    'alt': alt,
                    'larg': larg

                }

                obstaculos['obstaculo' + w] = obj;

                c.appendChild(criar_tag({
                  
                  'tp': 'div',
                  'att': {

                    'id': obj.id,
                    'class': 'o'

                  },
                  'style': {

                    'width': obj.larg + 'px',
                    'height': obj.alt + 'px',
                    'left': obj.x + 'px',
                    'top': obj.y + 'px'

                  }

                }));

            }

            function criar_jogador(){

              c.appendChild(criar_tag({
                    
                'tp': 'div',
                'att': {

                  'id': jogador.id

                },
                'style': {

                  'width': jogador.larg + 'px',
                  'height': jogador.alt + 'px',
                  'left': jogador.x + 'px',
                  'top': jogador.y + 'px'

                }

              }));

              c.appendChild(criar_tag({
                
                'tp': 'progress',
                'att': {
                  
                  'id': 'p_hp',
                  'value': jogador.hp,
                  'max': jogador.hp_max
                  
                },
                'style': {
                  
                  'width': '200px',
                  'height': '30px',
                  'left': mapa.x + 'px',
                  'top': '70px',
                  'backgroundColor': 'green'
                  
                }
                
              }));

            }
            
            function reset(){
              
              document.getElementById(jogador.id).remove();
              document.getElementById('p_hp').remove();

              document.getElementById(mapa.id).remove();
              mapa = {};
              
              for(const j in obstaculos){

                document.getElementById(obstaculos[j].id).remove();
                delete obstaculos[j];

              }
              
              for(const j in inimigos){

                document.getElementById(inimigos[j].id).remove();
                clearInterval(inimigos[j].mov);
                delete inimigos[j];

              }
              
              for(const j in portais){

                document.getElementById(portais[j].id).remove();
                delete portais[j];
                
              }

              for(const j in itens){

                document.getElementById(itens[j].id).remove();
                delete itens[j];

              }

              for(const j in armas){

                document.getElementById(armas[j].id).remove();
                clearInterval(armas[j].mov);
                delete armas[j];

              }
              
            }

            function entrou_portal(){

              for(const i in portais){

                if(colisao(jogador, portais[i])){

                  reset();

                  criar_mapa();

                  if(i == '1'){
                    
                    criar_portais(2);

                    if(perc(50)){
                      criar_portais(1);
                    }
                    
                    if(perc(50)){
                      criar_portais(3);
                    }
                    
                    if(perc(50)){
                      criar_portais(4);
                    }

                    jogador.x = Math.round((mapa.x + mapa.larg) - portais['2'].larg - (jogador.larg * 2));
                    jogador.y = Math.round(mapa.y + (mapa.alt/2) - (jogador.alt/2));

                  }else if(i == '2'){
                    
                    criar_portais(1);

                    if(perc(50)){
                      criar_portais(2);
                    }
                    
                    if(perc(50)){
                      criar_portais(3);
                    }
                    
                    if(perc(50)){
                      criar_portais(4);
                    }

                    jogador.x = Math.round(mapa.x + portais['1'].larg + jogador.larg);
                    jogador.y = Math.round(mapa.y + (mapa.alt/2) - (jogador.alt/2));

                  }else if(i == '3'){
                    
                    criar_portais(4);

                    if(perc(50)){
                      criar_portais(1);
                    }
                    
                    if(perc(50)){
                      criar_portais(2);
                    }
                    
                    if(perc(50)){
                      criar_portais(3);
                    }

                    jogador.x = Math.round(mapa.x + (mapa.larg/2) - (jogador.larg/2));
                    jogador.y = Math.round((mapa.y + mapa.alt) - portais['4'].alt - (jogador.alt * 2));

                  }else if(i == '4'){
                    
                    criar_portais(3);
                    
                    if(perc(50)){
                      criar_portais(1);
                    }
                    
                    if(perc(50)){
                      criar_portais(2);
                    }
                    
                    if(perc(50)){
                      criar_portais(4);
                    }

                    jogador.x = Math.round(mapa.x + (mapa.larg/2) - (jogador.larg/2));
                    jogador.y = Math.round(mapa.y + portais['3'].alt + jogador.alt);

                  }

                  criar_jogador();

                  for(k = randint(1, 3); k > 0; k--){

                    criar_inimigo();

                  }
                  
                  break;

                }

              }

            }

            function pegou_item(){

              for(const i in itens){

                if(colisao(jogador, itens[i])){

                  ad_inv(itens[i].obj, i);

                }

              }

            }

            function curar(pocao_nome){

                if(jogador.hp + ((jogador.hp_max * jogador.inventario[pocao_nome].poder)/100) <= jogador.hp_max){

                  jogador.hp = jogador.hp + ((jogador.hp_max * jogador.inventario[pocao_nome].poder)/100);

                }else{

                  jogador.hp = jogador.hp_max;

                }

                if(jogador.inventario[pocao_nome].quantidade == 1){

                  delete jogador.inventario[pocao_nome];

                }else{

                  jogador.inventario[pocao_nome].quantidade--;

                }
                  
                document.getElementById('p_hp').setAttribute('value', jogador.hp);

            }
            
            var jogador;
            
            function iniciar(){
              
              criar_mapa();
              
              criar_portais(3);
              
              criar_inimigo();
              
              jogador = {
                
                'id': 'p',
                'alt': 40,
                'larg': 40,
                'x': Math.round(mapa.x + (mapa.larg/2) - 20),
                'y': Math.round(mapa.y + mapa.alt - 125),
                'face': 'direita',
                'hp': 200,
                'hp_max': 200,
                'atq': 50,
                'inventario': {
                  
                },
                'equipamento': {
                  
                  'arma': {
                    
                    'nome': 'espada_madeira',
                    'texto': 'Espada de Madeira',
                    'poder': 5,
                    'tipo_atq': 'c'
                    
                  },
                  'armadura': lista_itens['vazio']
                  
                },
                'mov': {
                  
                  'direita': false,
                  'esquerda': false,
                  'cima': false,
                  'baixo': false
                  
                }
                
              }
              
              criar_jogador();
              
              ad_inv(lista_itens[6]);
              
            }
            
            document.getElementById('novo').onclick = function(){
              
              document.getElementById('inicial').style.display = 'none';
              iniciar();
              
            }

            // controles do jogador
            document.addEventListener('keydown', function(event){

                if(event.keyCode == 37){

                    clearInterval(jogador.mov.esquerda);

                    jogador.mov.esquerda = setInterval(() => {

                        entrou_portal();

                        pegou_item();

                        mov_geral(jogador, 'esquerda');
                          

                    }, 5);

                }else if(event.keyCode == 39){

                    clearInterval(jogador.mov.direita);

                    jogador.mov.direita = setInterval(() => {

                        entrou_portal();

                        pegou_item();

                        mov_geral(jogador, 'direita');

                    }, 5);

                }

                if(event.keyCode == 38){

                    clearInterval(jogador.mov.cima);

                    jogador.mov.cima = setInterval(() => {

                        entrou_portal();

                        pegou_item();

                        mov_geral(jogador, 'cima');

                    }, 5);

                }else if(event.keyCode == 40){

                    clearInterval(jogador.mov.baixo);

                    jogador.mov.baixo = setInterval(() => {

                        entrou_portal();

                        pegou_item();

                        mov_geral(jogador, 'baixo');

                    }, 5);

                }

                if(event.keyCode == 32){
                  
                  atacar(jogador);
                  
                }

                if(event.keyCode == 73){

                  var div = document.getElementById('div_inv');

                  if(div.style.display == 'none' || div.style.display == ''){

                    carregar_inv();

                    div.style.display = 'block';

                  }else{

                    div.style.display = 'none';

                  }

                }

                if(event.keyCode == 69){

                  var div = document.getElementById('div_equip');

                  if(div.style.display == 'none' || div.style.display == ''){

                    carregar_equip();

                    div.style.display = 'block';

                  }else{

                    div.style.display = 'none';

                  }

                }

            });

            document.addEventListener('keyup', function(event){

                if(event.keyCode == 37){

                    clearInterval(jogador.mov.esquerda);

                }else if(event.keyCode == 39){

                    clearInterval(jogador.mov.direita);

                }

                if(event.keyCode == 38){

                    clearInterval(jogador.mov.cima);

                }else if(event.keyCode == 40){

                    clearInterval(jogador.mov.baixo);

                }

            });

        </script>
    </body>
</html>